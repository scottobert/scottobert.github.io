<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Scott Obert</title><meta name=description content="Working with NoSQL databases like DynamoDB can be challenging when it comes to maintaining type safety and data consistency. In this post, we&rsquo;ll explore …"><link rel=canonical href=https://scottobert.com/posts/dynamodb-typescript/><meta property="og:title" content="DynamoDB with TypeScript: Type-Safe NoSQL Operations"><meta property="og:description" content="Working with NoSQL databases like DynamoDB can be challenging when it comes to maintaining type safety and data consistency. In this post, we&rsquo;ll explore …"><meta property="og:type" content="article"><meta property="og:url" content="https://scottobert.com/posts/dynamodb-typescript/"><meta property="og:site_name" content="Scott Obert"><meta name=twitter:card content="summary"><meta name=twitter:title content="DynamoDB with TypeScript: Type-Safe NoSQL Operations"><meta name=twitter:description content="Working with NoSQL databases like DynamoDB can be challenging when it comes to maintaining type safety and data consistency. In this post, we&rsquo;ll explore …"><link rel=stylesheet href=/css/style.css><script src=/js/npm-packages.js defer></script><script src=/js/search.js defer></script><script defer src=https://cloud.umami.is/script.js data-website-id=e2461896-021d-422a-b83f-624a8819309b></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body><header class=site-header><div class=container><div class=header-content><div class=header-left><h1><a href=/>Scott Obert</a></h1><nav><a href=/posts/>Blog</a>
<a href=/album/>Photo Album</a>
<button type=button class=search-toggle id=search-toggle-btn aria-label="Open search" title=Search>
<svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61.0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
<span>Search</span></button></nav></div><div class=social-links><a href=https://www.linkedin.com/in/scott-obert-3a7338b/ target=_blank rel="noopener noreferrer" title="LinkedIn Profile"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
<span>LinkedIn</span>
</a><a href=https://github.com/scottobert target=_blank rel="noopener noreferrer" title="GitHub Profile"><svg viewBox="0 0 24 24"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.335-1.755-1.335-1.755-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.605-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/></svg>
<span>GitHub</span></a></div></div></div></header><div class=container><nav class=breadcrumbs aria-label="Breadcrumb navigation"><ol class=breadcrumb-list><li class=breadcrumb-item><a href=https://scottobert.com/ title=Home><svg class="breadcrumb-home-icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
<span>Home</span></a></li><li class=breadcrumb-item><span class=breadcrumb-separator aria-hidden=true>/</span>
<a href=https://scottobert.com/posts/ title=Posts>Posts</a></li><li class=breadcrumb-item><span class=breadcrumb-separator aria-hidden=true>/</span>
<a href=https://scottobert.com/series/aws-and-typescript/ title="Series: AWS and Typescript"><svg class="breadcrumb-series-icon" viewBox="0 0 24 24"><path d="M9 4v1.38c-.83-.33-1.72-.5-2.61-.5-1.79.0-3.58.68-4.95 2.05l3.33 3.33h1.11v1.11c.86.86 1.98 1.31 3.11 1.31 1.13.0 2.25-.45 3.11-1.31V9.26h1.11l3.33-3.33c-1.37-1.37-3.16-2.05-4.95-2.05-.89.0-1.78.17-2.61.5V4H9z"/></svg>
<span>AWS and Typescript</span></a></li><li class=breadcrumb-item><span class=breadcrumb-separator aria-hidden=true>/</span>
<a href=https://scottobert.com/categories/cloud-computing title="Category: Cloud Computing"><svg class="breadcrumb-category-icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
<span>Cloud Computing</span></a></li><li class="breadcrumb-item breadcrumb-current"><span class=breadcrumb-separator aria-hidden=true>/</span>
<span class=breadcrumb-current-page aria-current=page>DynamoDB with TypeScript: Type-Safe NoSQL Operations</span></li></ol></nav><div class=content-layout><main class=main-content><article class=post><h1>DynamoDB with TypeScript: Type-Safe NoSQL Operations</h1><div class=post-meta><div class=post-meta-left><span>Jul 2, 2023</span>
<span>| Tags: AWS, TypeScript, DynamoDB, NoSQL, Database, Development</span></div><div class=post-meta-right><div class=quick-social-share><button type=button class=quick-share-toggle id=quick-share-toggle title="Share this post">
<svg viewBox="0 0 24 24"><path d="M18 16.08c-.76.0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66.0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66.0-3 1.34-3 3s1.34 3 3 3c.79.0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65.0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>
<span>Share</span></button><div class=quick-share-buttons id=quick-share-buttons><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="quick-share-button twitter" title="Share on Twitter"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="quick-share-button linkedin" title="Share on LinkedIn"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="quick-share-button facebook" title="Share on Facebook"><svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
</a><a href="https://reddit.com/submit?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&title=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="quick-share-button reddit" title="Share on Reddit"><svg viewBox="0 0 24 24"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg>
</a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&t=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="quick-share-button hackernews" title="Share on Hacker News"><svg viewBox="0 0 24 24"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
</a><a href="https://wa.me/?text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="quick-share-button whatsapp" title="Share on WhatsApp"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.465 3.488"/></svg>
</a><a href="mailto:?subject=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations&body=Check+out+this+article%3A+DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+-+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" class="quick-share-button email" title="Share via Email"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1.0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
</a><button type=button class="quick-share-button copy-link" data-url=https://scottobert.com/posts/dynamodb-typescript/ title="Copy link to clipboard">
<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1.0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1.0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1.0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button></div></div><script>(function(){const i=document.querySelector(".quick-social-share"),e=document.getElementById("quick-share-toggle"),t=document.getElementById("quick-share-buttons");if(!i||!e||!t)return;let n=!1;e.addEventListener("click",function(){n=!n,n?(t.classList.add("visible"),e.classList.add("active")):(t.classList.remove("visible"),e.classList.remove("active"))});const a=document.querySelectorAll(".quick-share-button.copy-link");a.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-url");navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{o(this)}).catch(()=>{s(e,this)}):s(e,this)})});function s(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),o(t)}catch(e){console.error("Fallback: Unable to copy",e),r(t)}document.body.removeChild(n)}function o(e){const n=e.getAttribute("title");e.setAttribute("title","Copied!"),e.classList.add("copied");const t=document.createElement("div");t.textContent="Copied!",t.style.position="absolute",t.style.bottom="100%",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="#28a745",t.style.color="white",t.style.padding="4px 8px",t.style.borderRadius="4px",t.style.fontSize="0.75rem",t.style.whiteSpace="nowrap",t.style.zIndex="1000",t.style.marginBottom="5px",e.style.position="relative",e.appendChild(t),setTimeout(()=>{e.setAttribute("title",n),e.classList.remove("copied"),t.parentNode&&e.removeChild(t)},2e3)}function r(e){const t=e.getAttribute("title");e.setAttribute("title","Copy failed"),e.classList.add("error"),setTimeout(()=>{e.setAttribute("title",t),e.classList.remove("error")},2e3)}})()</script></div></div><div class=post-content><p>Working with NoSQL databases like DynamoDB can be challenging when it comes to maintaining type safety and data consistency. In this post, we&rsquo;ll explore how to build robust, type-safe DynamoDB operations using TypeScript, covering everything from basic CRUD operations to advanced patterns like single-table design and transaction handling.</p><div class=plantuml-container><img id=plantuml-dynamodb-single-table class=plantuml-diagram>
<a id=plantuml-link-dynamodb-single-table href=# target=_blank class=plantuml-link title="Open diagram in new window"><span class=plantuml-link-icon>🔍</span></a></div><script src=/js/rawdeflate.js></script><script>function encode64(e){r="";for(i=0;i<e.length;i+=3)i+2==e.length?r+=append3bytes(e.charCodeAt(i),e.charCodeAt(i+1),0):i+1==e.length?r+=append3bytes(e.charCodeAt(i),0,0):r+=append3bytes(e.charCodeAt(i),e.charCodeAt(i+1),e.charCodeAt(i+2));return r}function append3bytes(e,t,n){return c1=e>>2,c2=(e&3)<<4|t>>4,c3=(t&15)<<2|n>>6,c4=n&63,r="",r+=encode6bit(c1&63),r+=encode6bit(c2&63),r+=encode6bit(c3&63),r+=encode6bit(c4&63),r}function encode6bit(e){return e<10?String.fromCharCode(48+e):(e-=10,e<26?String.fromCharCode(65+e):(e-=26,e<26?String.fromCharCode(97+e):(e-=26,e==0?"-":e==1?"_":"?")))}var deflater=window.SharedWorker&&new SharedWorker("/js/rawdeflate.js");deflater?(deflater.port.addEventListener("message",done_deflating,!1),deflater.port.start()):window.Worker&&(deflater=new Worker("/js/rawdeflate.js"),deflater.onmessage=done_deflating);function done_deflating(e){const s=document.getElementById("plantuml-dynamodb-single-table"),t="https://www.plantuml.com/plantuml/img/"+encode64(e.data);s.src=t;const n=document.getElementById("plantuml-link-dynamodb-single-table");n&&(n.href=t)}function compress(e){e=unescape(encodeURIComponent(e)),deflater?deflater.port&&deflater.port.postMessage?deflater.port.postMessage(e):deflater.postMessage(e):setTimeout(function(){done_deflating({data:deflate(e)})},100)}compress(`
@startuml DynamoDB Single Table Design
!define RECTANGLE class

package "Single Table Design" {
  database "DynamoDB Table" as table {
    rectangle "Partition Key (PK)" as pk
    rectangle "Sort Key (SK)" as sk
    rectangle "GSI1PK" as gsi1pk
    rectangle "GSI1SK" as gsi1sk
  }
  
  rectangle "User Entity" as user {
    rectangle "PK: USER#123" as user_pk
    rectangle "SK: USER#123" as user_sk
    rectangle "GSI1PK: EMAIL#user_at_domain.com" as user_gsi1pk
    rectangle "Data: name, email, dept" as user_data
  }
  
  rectangle "Order Entity" as order {
    rectangle "PK: ORDER#456" as order_pk
    rectangle "SK: ORDER#456" as order_sk
    rectangle "GSI1PK: USER#123" as order_gsi1pk
    rectangle "GSI1SK: ORDER#2023-07-02" as order_gsi1sk
    rectangle "Data: items, total, status" as order_data
  }
  
  rectangle "Product Entity" as product {
    rectangle "PK: PRODUCT#789" as product_pk
    rectangle "SK: PRODUCT#789" as product_sk
    rectangle "GSI1PK: CATEGORY#electronics" as product_gsi1pk
    rectangle "Data: name, price, stock" as product_data
  }
}

table --> user : Store
table --> order : Store
table --> product : Store

note right of table
  • Single table for all entities
  • Composite keys for relationships
  • GSI for access patterns
  • Type-safe operations
end note

note bottom of user
  Access Patterns:
  • Get user by ID: PK = USER#id
  • Get user by email: GSI1PK = EMAIL#email
end note

note bottom of order
  Access Patterns:
  • Get order by ID: PK = ORDER#id
  • Get orders by user: GSI1PK = USER#id
end note
@enduml
`)</script><h2 id=why-type-safety-matters-with-dynamodb>Why Type Safety Matters with DynamoDB</h2><p>DynamoDB&rsquo;s flexible schema brings both opportunities and challenges:</p><ul><li><strong>Runtime Safety</strong>: Prevent schema mismatches and data corruption at compile time</li><li><strong>Developer Experience</strong>: IntelliSense, autocomplete, and refactoring support</li><li><strong>Single-Table Design</strong>: Type safety becomes critical when multiple entities share the same table</li><li><strong>Access Pattern Validation</strong>: Ensure queries match your intended data access patterns</li><li><strong>Relationship Integrity</strong>: Maintain consistency across entity relationships</li></ul><h2 id=prerequisites>Prerequisites</h2><p>Essential tools and knowledge for type-safe DynamoDB development:</p><ul><li><strong>AWS SDK v3</strong>: <code>@aws-sdk/client-dynamodb</code> and <code>@aws-sdk/lib-dynamodb</code></li><li><strong>DynamoDB Concepts</strong>: Partition keys, sort keys, GSIs, and access patterns</li><li><strong>Single-Table Design</strong>: Understanding of NoSQL modeling principles</li><li><strong>TypeScript</strong>: Advanced type features like discriminated unions and type guards</li></ul><h2 id=type-safe-entity-design>Type-Safe Entity Design</h2><p>Create comprehensive, maintainable entity models using TypeScript&rsquo;s advanced type features:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/types/entities.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>BaseEntity</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>;           <span style=color:#75715e>// Partition Key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span>;           <span style=color:#75715e>// Sort Key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>gsi1pk?</span>: <span style=color:#66d9ef>string</span>;      <span style=color:#75715e>// Global Secondary Index 1 PK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>gsi1sk?</span>: <span style=color:#66d9ef>string</span>;      <span style=color:#75715e>// Global Secondary Index 1 SK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>entityType</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createdAt</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>updatedAt</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>version</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseEntity</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;USER&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>department?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>isActive</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lastLoginAt?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Order</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseEntity</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ORDER&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>totalAmount</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>currency</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>OrderItem</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shippingAddress</span>: <span style=color:#66d9ef>Address</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>placedAt</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fulfillmentDate?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseEntity</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;PRODUCT&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>currency</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>category</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stockQuantity</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>isAvailable</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span>: <span style=color:#66d9ef>string</span>[];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Supporting types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>OrderStatus</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>PENDING</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;PENDING&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>CONFIRMED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;CONFIRMED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SHIPPED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SHIPPED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DELIVERED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DELIVERED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>CANCELLED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;CANCELLED&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderItem</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>productName</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>unitPrice</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>totalPrice</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Address</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>street</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>city</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>zipCode</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>country</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Type guards for runtime safety
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isUser</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>BaseEntity</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>entity</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entity</span>.<span style=color:#a6e22e>entityType</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;USER&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isOrder</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>BaseEntity</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>entity</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>Order</span> <span style=color:#f92672>=&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entity</span>.<span style=color:#a6e22e>entityType</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;ORDER&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isProduct</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>BaseEntity</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>entity</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>=&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entity</span>.<span style=color:#a6e22e>entityType</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;PRODUCT&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Union type for type-safe entity handling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Entity</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span>;
</span></span></code></pre></div><h2 id=repository-pattern-implementation>Repository Pattern Implementation</h2><p>Build a robust, reusable repository base class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/repositories/base-repository.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamoDBClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@aws-sdk/client-dynamodb&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DynamoDBDocumentClient</span>, 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>PutCommand</span>, 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>GetCommand</span>, 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>UpdateCommand</span>, 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DeleteCommand</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>QueryCommand</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>BatchGetCommand</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@aws-sdk/lib-dynamodb&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BaseEntity</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/entities&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseRepository</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>BaseEntity</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>docClient</span>: <span style=color:#66d9ef>DynamoDBDocumentClient</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dynamoClient</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBClient</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>maxAttempts</span>: <span style=color:#66d9ef>3</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>retryMode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;adaptive&#39;</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DynamoDBDocumentClient</span>.<span style=color:#66d9ef>from</span>(<span style=color:#a6e22e>dynamoClient</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>marshallOptions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>convertEmptyValues</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>removeUndefinedValues</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableName</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>Omit</span>&lt;<span style=color:#f92672>T</span>, <span style=color:#e6db74>&#39;createdAt&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;updatedAt&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;version&#39;</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>entityWithMetadata</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      ...<span style=color:#a6e22e>entity</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>createdAt</span>: <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>updatedAt</span>: <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>version</span>: <span style=color:#66d9ef>1</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PutCommand</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Item</span>: <span style=color:#66d9ef>entityWithMetadata</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ConditionExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;attribute_not_exists(pk) AND attribute_not_exists(sk)&#39;</span>
</span></span><span style=display:flex><span>      }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>entityWithMetadata</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;ConditionalCheckFailedException&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Entity already exists: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>entity</span>.<span style=color:#a6e22e>pk</span><span style=color:#e6db74>}</span><span style=color:#e6db74>#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>entity</span>.<span style=color:#a6e22e>sk</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>Item</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GetCommand</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>pk</span>, <span style=color:#a6e22e>sk</span> }
</span></span><span style=display:flex><span>    }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Item</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>update</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span>, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updates</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>Omit</span>&lt;<span style=color:#f92672>T</span>, <span style=color:#e6db74>&#39;pk&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;sk&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;entityType&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;createdAt&#39;</span>&gt;&gt;,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expectedVersion?</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updateExpressions</span>: <span style=color:#66d9ef>string</span>[] <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attributeNames</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>string</span>&gt; <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attributeValues</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Build update expression dynamically
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    Object.<span style=color:#a6e22e>entries</span>(<span style=color:#a6e22e>updates</span>).<span style=color:#a6e22e>forEach</span>(([<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>], <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;version&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updateExpressions</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>`#attr</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74> = :val</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeNames</span>[<span style=color:#e6db74>`#attr</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>key</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>`:val</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Always update timestamp and version
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>updateExpressions</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#39;#updatedAt = :updatedAt&#39;</span>, <span style=color:#e6db74>&#39;#version = #version + :inc&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>attributeNames</span>[<span style=color:#e6db74>&#39;#updatedAt&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;updatedAt&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>attributeNames</span>[<span style=color:#e6db74>&#39;#version&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;version&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:updatedAt&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:inc&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>conditionExpression</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;attribute_exists(pk)&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>expectedVersion</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>conditionExpression</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39; AND #version = :expectedVersion&#39;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:expectedVersion&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>expectedVersion</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>Attributes</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UpdateCommand</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>pk</span>, <span style=color:#a6e22e>sk</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>UpdateExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`SET </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>updateExpressions</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;, &#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpressionAttributeNames</span>: <span style=color:#66d9ef>attributeNames</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>attributeValues</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>conditionExpression</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ReturnValues</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ALL_NEW&#39;</span>
</span></span><span style=display:flex><span>      }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Attributes</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;ConditionalCheckFailedException&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#a6e22e>expectedVersion</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Version mismatch&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Entity not found&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>expectedVersion?</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>conditionExpression</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;attribute_exists(pk)&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attributeValues</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>expectedVersion</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>conditionExpression</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39; AND version = :expectedVersion&#39;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:expectedVersion&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>expectedVersion</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DeleteCommand</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>pk</span>, <span style=color:#a6e22e>sk</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>conditionExpression</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>Object.keys</span>(<span style=color:#a6e22e>attributeValues</span>).<span style=color:#a6e22e>length</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>attributeValues</span> : <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>      }));
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;ConditionalCheckFailedException&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#a6e22e>expectedVersion</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Version mismatch&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Entity not found&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pkValue</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>skCondition</span><span style=color:#f92672>?:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>operator</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;begins_with&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;between&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;&lt;&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;&lt;=&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;&gt;&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;&gt;=&#39;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> [<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>];
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>indexName?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>limit?</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>scanIndexForward?</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>exclusiveStartKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt;;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>T</span>[]; <span style=color:#a6e22e>lastEvaluatedKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; }<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>keyConditionExpression</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pk = :pk&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attributeValues</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#39;:pk&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pkValue</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>skCondition</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>operator</span>, <span style=color:#a6e22e>value</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>skCondition</span>;
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>operator</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;begins_with&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>keyConditionExpression</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39; AND begins_with(sk, :sk)&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:sk&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>operator</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;between&#39;</span> <span style=color:#f92672>&amp;&amp;</span> Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>value</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>keyConditionExpression</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39; AND sk BETWEEN :sk1 AND :sk2&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:sk1&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:sk2&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>keyConditionExpression</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>` AND sk </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>operator</span><span style=color:#e6db74>}</span><span style=color:#e6db74> :sk`</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attributeValues</span>[<span style=color:#e6db74>&#39;:sk&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>Items</span>, <span style=color:#a6e22e>LastEvaluatedKey</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>QueryCommand</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>IndexName</span>: <span style=color:#66d9ef>options?.indexName</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>KeyConditionExpression</span>: <span style=color:#66d9ef>keyConditionExpression</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>attributeValues</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Limit</span>: <span style=color:#66d9ef>options?.limit</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ScanIndexForward</span>: <span style=color:#66d9ef>options?.scanIndexForward</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ExclusiveStartKey</span>: <span style=color:#66d9ef>options?.exclusiveStartKey</span>
</span></span><span style=display:flex><span>    }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>Items</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span>[],
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lastEvaluatedKey</span>: <span style=color:#66d9ef>LastEvaluatedKey</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>batchGet</span>(<span style=color:#a6e22e>keys</span>: <span style=color:#66d9ef>Array</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span> }<span style=color:#f92672>&gt;</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keys</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>batches</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>chunkArray</span>(<span style=color:#a6e22e>keys</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>results</span>: <span style=color:#66d9ef>T</span>[] <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>batch</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>batches</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>Responses</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>BatchGetCommand</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>RequestItems</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span>]<span style=color:#f92672>:</span> { <span style=color:#a6e22e>Keys</span>: <span style=color:#66d9ef>batch</span> }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>Responses</span><span style=color:#f92672>?</span>.[<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>results</span>.<span style=color:#a6e22e>push</span>(...(<span style=color:#a6e22e>Responses</span>[<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span>] <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span>[]));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>results</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>chunkArray</span>&lt;<span style=color:#f92672>U</span>&gt;(<span style=color:#a6e22e>array</span>: <span style=color:#66d9ef>U</span>[], <span style=color:#a6e22e>chunkSize</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>U</span>[][] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Array.<span style=color:#66d9ef>from</span>({ <span style=color:#a6e22e>length</span>: <span style=color:#66d9ef>Math.ceil</span>(<span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>chunkSize</span>) }, (<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>chunkSize</span>, <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>chunkSize</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>chunkSize</span>)
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=specialized-repository-implementations>Specialized Repository Implementations</h2><p>Create domain-specific repositories with tailored access patterns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/repositories/user-repository.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BaseRepository</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./base-repository&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>User</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/entities&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseRepository</span>&lt;<span style=color:#f92672>User</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>userData</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>department?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  })<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>User</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>create</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>gsi1pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`EMAIL#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>email</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>gsi1sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userData</span>.<span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;USER&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>userData.userId</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>userData.email</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>userData.name</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>department</span>: <span style=color:#66d9ef>userData.department</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>isActive</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUserById</span>(<span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>User</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUserByEmail</span>(<span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>User</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`EMAIL#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>email</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>items</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>||</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>updateUser</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updates</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>Pick</span>&lt;<span style=color:#f92672>User</span>, <span style=color:#e6db74>&#39;name&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;department&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;isActive&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;lastLoginAt&#39;</span>&gt;&gt;,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expectedVersion?</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>User</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>update</span>(<span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>updates</span>, <span style=color:#a6e22e>expectedVersion</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUsersByDepartment</span>(<span style=color:#a6e22e>department</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>User</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`DEPARTMENT#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>department</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI2&#39;</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>items</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/repositories/order-repository.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BaseRepository</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./base-repository&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Order</span>, <span style=color:#a6e22e>OrderStatus</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/entities&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderRepository</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseRepository</span>&lt;<span style=color:#f92672>Order</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createOrder</span>(<span style=color:#a6e22e>orderData</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>totalAmount</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currency</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>Order</span>[<span style=color:#e6db74>&#39;items&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shippingAddress</span>: <span style=color:#66d9ef>Order</span>[<span style=color:#e6db74>&#39;shippingAddress&#39;</span>];
</span></span><span style=display:flex><span>  })<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>create</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>gsi1pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>gsi1sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ORDER&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>orderData.orderId</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>orderData.userId</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus.PENDING</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>totalAmount</span>: <span style=color:#66d9ef>orderData.totalAmount</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currency</span>: <span style=color:#66d9ef>orderData.currency</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>orderData.items</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>shippingAddress</span>: <span style=color:#66d9ef>orderData.shippingAddress</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>placedAt</span>: <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>()
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getOrderById</span>(<span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getOrdersByUserId</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>limit?</span>: <span style=color:#66d9ef>number</span>; <span style=color:#a6e22e>exclusiveStartKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; }
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>orders</span>: <span style=color:#66d9ef>Order</span>[]; <span style=color:#a6e22e>lastEvaluatedKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; }<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>operator</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;begins_with&#39;</span>, <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ORDER#&#39;</span> },
</span></span><span style=display:flex><span>      { 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>limit</span>: <span style=color:#66d9ef>options?.limit</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>scanIndexForward</span>: <span style=color:#66d9ef>false</span>, <span style=color:#75715e>// Most recent first
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>exclusiveStartKey</span>: <span style=color:#66d9ef>options?.exclusiveStartKey</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>orders</span>: <span style=color:#66d9ef>result.items</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lastEvaluatedKey</span>: <span style=color:#66d9ef>result.lastEvaluatedKey</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>updateOrderStatus</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expectedVersion?</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updates</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>Order</span>&gt; <span style=color:#f92672>=</span> { <span style=color:#a6e22e>status</span> };
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>OrderStatus</span>.<span style=color:#a6e22e>DELIVERED</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>updates</span>.<span style=color:#a6e22e>fulfillmentDate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>update</span>(<span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>updates</span>, <span style=color:#a6e22e>expectedVersion</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getOrdersByStatus</span>(<span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus</span>, <span style=color:#a6e22e>limit?</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`STATUS#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>status</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI3&#39;</span>, <span style=color:#a6e22e>limit</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>items</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=transaction-management>Transaction Management</h2><p>Implement type-safe transaction operations for complex business logic:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/services/transaction-service.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamoDBClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@aws-sdk/client-dynamodb&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamoDBDocumentClient</span>, <span style=color:#a6e22e>TransactWriteCommand</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@aws-sdk/lib-dynamodb&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TransactionService</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>docClient</span>: <span style=color:#66d9ef>DynamoDBDocumentClient</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DynamoDBDocumentClient</span>.<span style=color:#66d9ef>from</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBClient</span>({}));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableName</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>executeTransaction</span>(<span style=color:#a6e22e>operations</span>: <span style=color:#66d9ef>TransactionOperation</span>[])<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>operations</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>25</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;DynamoDB transactions support maximum 25 operations&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transactItems</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>operations</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>op</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buildTransactionItem</span>(<span style=color:#a6e22e>op</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>docClient</span>.<span style=color:#a6e22e>send</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TransactWriteCommand</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TransactItems</span>: <span style=color:#66d9ef>transactItems</span>
</span></span><span style=display:flex><span>    }));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>buildTransactionItem</span>(<span style=color:#a6e22e>operation</span>: <span style=color:#66d9ef>TransactionOperation</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>any</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#66d9ef>type</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>operation</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Put&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Put</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Item</span>: <span style=color:#66d9ef>operation.item</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>operation.conditionExpression</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeNames</span>: <span style=color:#66d9ef>operation.expressionAttributeNames</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>operation.expressionAttributeValues</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Update&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Update</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Key</span>: <span style=color:#66d9ef>operation.key</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>UpdateExpression</span>: <span style=color:#66d9ef>operation.updateExpression</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>operation.conditionExpression</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeNames</span>: <span style=color:#66d9ef>operation.expressionAttributeNames</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>operation.expressionAttributeValues</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Delete&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Delete</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Key</span>: <span style=color:#66d9ef>operation.key</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>operation.conditionExpression</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;ConditionCheck&#39;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>ConditionCheck</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Key</span>: <span style=color:#66d9ef>operation.key</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ConditionExpression</span>: <span style=color:#66d9ef>operation.conditionExpression</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeNames</span>: <span style=color:#66d9ef>operation.expressionAttributeNames</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ExpressionAttributeValues</span>: <span style=color:#66d9ef>operation.expressionAttributeValues</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Unsupported operation type: </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>type</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>TransactionOperation</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Put&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;Update&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;Delete&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;ConditionCheck&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>key</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>pk</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>sk</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>item?</span>: <span style=color:#66d9ef>any</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>updateExpression?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>conditionExpression?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>expressionAttributeNames?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>string</span>&gt;;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>expressionAttributeValues?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt;;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Business logic example: Order fulfillment with inventory update
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fulfillOrder</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>transactionService</span>: <span style=color:#66d9ef>TransactionService</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>Array</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>quantity</span>: <span style=color:#66d9ef>number</span> }<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orderVersion</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>operations</span>: <span style=color:#66d9ef>TransactionOperation</span>[] <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update order status
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Update&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>updateExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SET #status = :status, #fulfilled = :fulfilled, version = version + :inc&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>conditionExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;version = :expectedVersion&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expressionAttributeNames</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;#status&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;status&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;#fulfilled&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;fulfillmentDate&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expressionAttributeValues</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:status&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;DELIVERED&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:fulfilled&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>(),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:expectedVersion&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>orderVersion</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:inc&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Add inventory updates for each item
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>items</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>item</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>operations</span>.<span style=color:#a6e22e>push</span>({
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Update&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`PRODUCT#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>productId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`PRODUCT#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>productId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>updateExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SET stockQuantity = stockQuantity - :qty, version = version + :inc&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>conditionExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;stockQuantity &gt;= :qty&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expressionAttributeValues</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:qty&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>quantity</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;:inc&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>transactionService</span>.<span style=color:#a6e22e>executeTransaction</span>(<span style=color:#a6e22e>operations</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=error-handling-and-utilities>Error Handling and Utilities</h2><p>Create comprehensive error handling for robust DynamoDB operations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/utils/dynamodb-errors.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamoDBError</span> <span style=color:#66d9ef>extends</span> Error {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>code</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>statusCode</span>: <span style=color:#66d9ef>number</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>retryable</span>: <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  ) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DynamoDBError&#39;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EntityNotFoundError</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DynamoDBError</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>entityType</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>entityType</span><span style=color:#e6db74>}</span><span style=color:#e6db74> not found: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>key</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>&#39;ENTITY_NOT_FOUND&#39;</span>, <span style=color:#ae81ff>404</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EntityAlreadyExistsError</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DynamoDBError</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>entityType</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>entityType</span><span style=color:#e6db74>}</span><span style=color:#e6db74> already exists: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>key</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>&#39;ENTITY_ALREADY_EXISTS&#39;</span>, <span style=color:#ae81ff>409</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VersionMismatchError</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DynamoDBError</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>expected</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>actual?</span>: <span style=color:#66d9ef>number</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`Version mismatch. Expected </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>expected</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>actual</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>`, got </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>actual</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;VERSION_MISMATCH&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>409</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleDynamoDBError</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>errorMap</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#960050;background-color:#1e0010>()</span> <span style=color:#960050;background-color:#1e0010>=</span>&gt; <span style=color:#a6e22e>DynamoDBError</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ConditionalCheckFailedException</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Conditional check failed&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;CONDITIONAL_CHECK_FAILED&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>409</span>
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ProvisionedThroughputExceededException</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Provisioned throughput exceeded&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;THROUGHPUT_EXCEEDED&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>429</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ResourceNotFoundException</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Table not found&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;TABLE_NOT_FOUND&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>TransactionCanceledException</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Transaction cancelled&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;TRANSACTION_CANCELLED&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>409</span>
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ValidationException</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;VALIDATION_ERROR&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>errorHandler</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>errorMap</span>[<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>name</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>errorHandler</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>errorHandler</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBError</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;Unknown DynamoDB error&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;UNKNOWN_ERROR&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>500</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=advanced-query-patterns>Advanced Query Patterns</h2><div class=plantuml-container><img id=plantuml-dynamodb-query-patterns class=plantuml-diagram>
<a id=plantuml-link-dynamodb-query-patterns href=# target=_blank class=plantuml-link title="Open diagram in new window"><span class=plantuml-link-icon>🔍</span></a></div><script src=/js/rawdeflate.js></script><script>function encode64(e){r="";for(i=0;i<e.length;i+=3)i+2==e.length?r+=append3bytes(e.charCodeAt(i),e.charCodeAt(i+1),0):i+1==e.length?r+=append3bytes(e.charCodeAt(i),0,0):r+=append3bytes(e.charCodeAt(i),e.charCodeAt(i+1),e.charCodeAt(i+2));return r}function append3bytes(e,t,n){return c1=e>>2,c2=(e&3)<<4|t>>4,c3=(t&15)<<2|n>>6,c4=n&63,r="",r+=encode6bit(c1&63),r+=encode6bit(c2&63),r+=encode6bit(c3&63),r+=encode6bit(c4&63),r}function encode6bit(e){return e<10?String.fromCharCode(48+e):(e-=10,e<26?String.fromCharCode(65+e):(e-=26,e<26?String.fromCharCode(97+e):(e-=26,e==0?"-":e==1?"_":"?")))}var deflater=window.SharedWorker&&new SharedWorker("/js/rawdeflate.js");deflater?(deflater.port.addEventListener("message",done_deflating,!1),deflater.port.start()):window.Worker&&(deflater=new Worker("/js/rawdeflate.js"),deflater.onmessage=done_deflating);function done_deflating(e){const s=document.getElementById("plantuml-dynamodb-query-patterns"),t="https://www.plantuml.com/plantuml/img/"+encode64(e.data);s.src=t;const n=document.getElementById("plantuml-link-dynamodb-query-patterns");n&&(n.href=t)}function compress(e){e=unescape(encodeURIComponent(e)),deflater?deflater.port&&deflater.port.postMessage?deflater.port.postMessage(e):deflater.postMessage(e):setTimeout(function(){done_deflating({data:deflate(e)})},100)}compress(`
@startuml DynamoDB Access Patterns
!define RECTANGLE class

package "Query Patterns" {
  rectangle "Primary Key Access" as pk {
    rectangle "GetItem" as get
    rectangle "PutItem" as put
    rectangle "UpdateItem" as update
    rectangle "DeleteItem" as delete
  }
  
  rectangle "Query Operations" as query {
    rectangle "Single Entity Type" as single
    rectangle "Related Entities" as related
    rectangle "Time-based Queries" as time
    rectangle "Status Filtering" as status
  }
  
  rectangle "Global Secondary Index" as gsi {
    rectangle "Alternative Access" as alt
    rectangle "Inverted Relationships" as invert
    rectangle "Sparse Index" as sparse
  }
  
  rectangle "Batch Operations" as batch {
    rectangle "BatchGet" as bget
    rectangle "BatchWrite" as bwrite
    rectangle "Transactions" as trans
  }
}

get --> single : Direct lookup
query --> related : One-to-many
query --> time : Sort by timestamp
gsi --> alt : Email lookup
gsi --> invert : User's orders
batch --> trans : Atomic operations

note right of pk
  • Fast, consistent performance
  • Single item operations
  • Strong consistency
end note

note right of query
  • Efficient range queries
  • Sort key conditions
  • Pagination support
end note

note right of gsi
  • Alternative query patterns
  • Eventually consistent
  • Sparse data support
end note
@enduml
`)</script><p>Implement advanced query patterns and utilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/services/query-service.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>BaseRepository</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../repositories/base-repository&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Entity</span>, <span style=color:#a6e22e>User</span>, <span style=color:#a6e22e>Order</span>, <span style=color:#a6e22e>isUser</span>, <span style=color:#a6e22e>isOrder</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/entities&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QueryService</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>repository</span>: <span style=color:#66d9ef>BaseRepository</span>&lt;<span style=color:#f92672>Entity</span>&gt;) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Paginated queries with type safety
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getPaginatedResults</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>Entity</span>&gt;(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>lastKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt;) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>T</span>[]; <span style=color:#a6e22e>lastEvaluatedKey?</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>any</span>&gt; }<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pageSize</span>: <span style=color:#66d9ef>number</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>T</span>[]; <span style=color:#a6e22e>nextToken?</span>: <span style=color:#66d9ef>string</span> }<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryFn</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>result.items.slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>pageSize</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>nextToken</span>: <span style=color:#66d9ef>result.lastEvaluatedKey</span> <span style=color:#f92672>?</span> 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Buffer</span>.<span style=color:#66d9ef>from</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>lastEvaluatedKey</span>)).<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#39;base64&#39;</span>) <span style=color:#f92672>:</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Multi-entity type filtering
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getEntitiesByType</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>Entity</span>&gt;(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pkValue</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entityType</span>: <span style=color:#66d9ef>T</span>[<span style=color:#e6db74>&#39;entityType&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>typeGuard</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>Entity</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>entity</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>T</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pkValue</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>operator</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;begins_with&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>entityType</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>items</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>typeGuard</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Complex relationship queries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUserWithOrders</span>(<span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span><span style=color:#f92672>&lt;</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>: <span style=color:#66d9ef>User</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>orders</span>: <span style=color:#66d9ef>Order</span>[];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>totalSpent</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  }<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get user data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>user</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isUser</span>(<span style=color:#a6e22e>user</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>user</span>: <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>orders</span><span style=color:#f92672>:</span> [], <span style=color:#a6e22e>totalSpent</span>: <span style=color:#66d9ef>0</span> };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get user&#39;s orders
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>operator</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;begins_with&#39;</span>, <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ORDER#&#39;</span> },
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span>, <span style=color:#a6e22e>scanIndexForward</span>: <span style=color:#66d9ef>false</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>orders</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>items</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>isOrder</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>totalSpent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>orders</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>sum</span>, <span style=color:#a6e22e>order</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>order</span>.<span style=color:#a6e22e>totalAmount</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>orders</span>, <span style=color:#a6e22e>totalSpent</span> };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Time-based range queries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getOrdersInDateRange</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startDate</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endDate</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>items</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>query</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`USER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>      { 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>operator</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;between&#39;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>startDate</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`ORDER#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>endDate</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] 
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span> }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>items</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>isOrder</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=testing-strategy>Testing Strategy</h2><p>Implement comprehensive testing with proper mocking:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// tests/repositories/user-repository.test.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>UserRepository</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../../src/repositories/user-repository&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamoDBDocumentClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@aws-sdk/lib-dynamodb&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>mockClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk-client-mock&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;aws-sdk-client-mock-jest&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mockDynamoClient</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mockClient</span>(<span style=color:#a6e22e>DynamoDBDocumentClient</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;UserRepository&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>userRepository</span>: <span style=color:#66d9ef>UserRepository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beforeEach</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mockDynamoClient</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userRepository</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserRepository</span>(<span style=color:#e6db74>&#39;test-table&#39;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;createUser&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;creates user with proper key structure&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mockDynamoClient</span>.<span style=color:#a6e22e>resolves</span>({});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userData</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user-123&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;test@example.com&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Test User&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>department</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Engineering&#39;</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>userRepository</span>.<span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>userData</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>pk</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#39;USER#user-123&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>sk</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#39;USER#user-123&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>gsi1pk</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#39;EMAIL#test@example.com&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>entityType</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#39;USER&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>isActive</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>version</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>createdAt</span>).<span style=color:#a6e22e>toBeDefined</span>();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;handles creation conflicts gracefully&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>error</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Conditional check failed&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ConditionalCheckFailedException&#39;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mockDynamoClient</span>.<span style=color:#a6e22e>rejects</span>(<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userData</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user-123&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;test@example.com&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Test User&#39;</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>userRepository</span>.<span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>userData</span>)).<span style=color:#a6e22e>rejects</span>.<span style=color:#a6e22e>toThrow</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Entity already exists&#39;</span>
</span></span><span style=display:flex><span>      );
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;getUserByEmail&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;returns user when found via GSI&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mockUser</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;USER#user-123&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sk</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;USER#user-123&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>entityType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;USER&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user-123&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;test@example.com&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Test User&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>isActive</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;2023-07-02T10:00:00Z&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;2023-07-02T10:00:00Z&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>version</span>: <span style=color:#66d9ef>1</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mockDynamoClient</span>.<span style=color:#a6e22e>resolves</span>({ <span style=color:#a6e22e>Items</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>mockUser</span>] });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>userRepository</span>.<span style=color:#a6e22e>getUserByEmail</span>(<span style=color:#e6db74>&#39;test@example.com&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>mockUser</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>mockDynamoClient</span>).<span style=color:#a6e22e>toHaveReceivedCommandWith</span>(<span style=color:#e6db74>&#39;QueryCommand&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>TableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;test-table&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>IndexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>KeyConditionExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;pk = :pk&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpressionAttributeValues</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;:pk&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;EMAIL#test@example.com&#39;</span> }
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;returns null when user not found&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mockDynamoClient</span>.<span style=color:#a6e22e>resolves</span>({ <span style=color:#a6e22e>Items</span><span style=color:#f92672>:</span> [] });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>userRepository</span>.<span style=color:#a6e22e>getUserByEmail</span>(<span style=color:#e6db74>&#39;nonexistent@example.com&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toBeNull</span>();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=infrastructure-as-code>Infrastructure as Code</h2><p>Define your DynamoDB table using AWS CDK:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// infrastructure/database-stack.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Stack</span>, <span style=color:#a6e22e>StackProps</span>, <span style=color:#a6e22e>RemovalPolicy</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-cdk-lib&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Table</span>, <span style=color:#a6e22e>AttributeType</span>, <span style=color:#a6e22e>BillingMode</span>, <span style=color:#a6e22e>ProjectionType</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-cdk-lib/aws-dynamodb&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Construct</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;constructs&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseStack</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Stack</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>readonly</span> <span style=color:#a6e22e>table</span>: <span style=color:#66d9ef>Table</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>scope</span>: <span style=color:#66d9ef>Construct</span>, <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>props?</span>: <span style=color:#66d9ef>StackProps</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>table</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Table</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;MainTable&#39;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-main-table&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>partitionKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;pk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>sortKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;sk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>billingMode</span>: <span style=color:#66d9ef>BillingMode.PAY_PER_REQUEST</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pointInTimeRecovery</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>removalPolicy</span>: <span style=color:#66d9ef>RemovalPolicy.RETAIN</span>,
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Global Secondary Index 1: For alternative access patterns
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>globalSecondaryIndexes</span><span style=color:#f92672>:</span> [{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI1&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>partitionKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gsi1pk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sortKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gsi1sk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>projectionType</span>: <span style=color:#66d9ef>ProjectionType.ALL</span>
</span></span><span style=display:flex><span>      }, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>indexName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;GSI2&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>partitionKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gsi2pk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sortKey</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gsi2sk&#39;</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AttributeType</span>.<span style=color:#a6e22e>STRING</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>projectionType</span>: <span style=color:#66d9ef>ProjectionType.ALL</span>
</span></span><span style=display:flex><span>      }]
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Building type-safe DynamoDB operations with TypeScript creates a robust foundation for scalable NoSQL applications. This approach provides:</p><ul><li><strong>Type Safety</strong>: Compile-time guarantees for data shape consistency</li><li><strong>Single-Table Design</strong>: Efficient modeling with maintained type safety</li><li><strong>Repository Pattern</strong>: Clean separation of concerns and testable code</li><li><strong>Transaction Support</strong>: ACID compliance for complex business operations</li><li><strong>Error Handling</strong>: Graceful failure management with typed exceptions</li></ul><p>Key benefits of this approach include:</p><ol><li><strong>Reduced Runtime Errors</strong>: TypeScript catches schema mismatches at compile time</li><li><strong>Improved Developer Experience</strong>: IntelliSense and autocomplete for database operations</li><li><strong>Maintainable Code</strong>: Clear interfaces and consistent patterns across the codebase</li><li><strong>Scalable Architecture</strong>: Repository pattern supports growth and complexity</li><li><strong>Testing Confidence</strong>: Comprehensive test coverage with proper mocking</li></ol><p>The patterns demonstrated here support complex single-table designs while maintaining type safety throughout your application. The combination of strong typing, comprehensive error handling, and proper abstraction creates a maintainable architecture that scales with your needs.</p><p>In our next post, we&rsquo;ll explore <strong>AWS WebSockets with TypeScript</strong>, building real-time communication features that integrate seamlessly with the DynamoDB patterns established here.</p></div><div class=social-share><h3 class=social-share-title>Share this post</h3><div class=social-share-buttons><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+-+%3Cp%3EWorking+with+NoSQL+databases+like+DynamoDB+can+be+challenging+when+it+comes+to+maintaining+type+safety+and+data+consistency.+In+this+post%2C+we%26rsquo%3Bll+explore+%E2%80%A6%3C%2Fp%3E" target=_blank rel="noopener noreferrer" class="social-share-button twitter" title="Share on Twitter"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
<span>Twitter</span>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="social-share-button linkedin" title="Share on LinkedIn"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
<span>LinkedIn</span>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="social-share-button facebook" title="Share on Facebook"><svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
<span>Facebook</span>
</a><a href="https://reddit.com/submit?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&title=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="social-share-button reddit" title="Share on Reddit"><svg viewBox="0 0 24 24"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg>
<span>Reddit</span>
</a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&t=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="social-share-button hackernews" title="Share on Hacker News"><svg viewBox="0 0 24 24"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
<span>Hacker News</span>
</a><a href="https://wa.me/?text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="social-share-button whatsapp" title="Share on WhatsApp"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.465 3.488"/></svg>
<span>WhatsApp</span>
</a><a href="mailto:?subject=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations&body=Check+out+this+article%3A+DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+-+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" class="social-share-button email" title="Share via Email"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1.0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
<span>Email</span>
</a><button type=button class="social-share-button copy-link" data-url=https://scottobert.com/posts/dynamodb-typescript/ title="Copy link to clipboard">
<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1.0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1.0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1.0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
<span>Copy Link</span></button></div></div><script>(function(){const n=document.querySelectorAll(".copy-link");n.forEach(n=>{n.addEventListener("click",function(){const n=this.getAttribute("data-url");navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(n).then(()=>{t(this)}).catch(()=>{e(n,this)}):e(n,this)})});function e(e,n){const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy"),t(n)}catch(e){console.error("Fallback: Unable to copy",e),s(n)}document.body.removeChild(o)}function t(e){const t=e.querySelector("span").textContent;e.querySelector("span").textContent="Copied!",e.classList.add("copied"),setTimeout(()=>{e.querySelector("span").textContent=t,e.classList.remove("copied")},2e3)}function s(e){const t=e.querySelector("span").textContent;e.querySelector("span").textContent="Error",e.classList.add("error"),setTimeout(()=>{e.querySelector("span").textContent=t,e.classList.remove("error")},2e3)}})()</script><div id=comments-section style="margin-top:2rem;padding-top:2rem;border-top:1px solid #e1e5e9"><h3 style=margin-bottom:1rem;color:#586069>Comments</h3><script src=https://giscus.app/client.js data-repo=scottobert/scottobert.github.io data-repo-id=R_kgDOHRSG6A data-category=General data-category-id=DIC_kwDOHRSG6M4CrQaA data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article><div class=floating-social-share id=floating-share><div class=floating-share-toggle id=share-toggle title="Share this post"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76.0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66.0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66.0-3 1.34-3 3s1.34 3 3 3c.79.0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65.0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg></div><div class=floating-share-buttons id=share-buttons><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="floating-share-button twitter" title="Share on Twitter"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="floating-share-button linkedin" title="Share on LinkedIn"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="floating-share-button facebook" title="Share on Facebook"><svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
</a><a href="https://reddit.com/submit?url=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&title=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="floating-share-button reddit" title="Share on Reddit"><svg viewBox="0 0 24 24"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg>
</a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F&t=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations" target=_blank rel="noopener noreferrer" class="floating-share-button hackernews" title="Share on Hacker News"><svg viewBox="0 0 24 24"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
</a><a href="https://wa.me/?text=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" target=_blank rel="noopener noreferrer" class="floating-share-button whatsapp" title="Share on WhatsApp"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893A11.821 11.821.0 0020.465 3.488"/></svg>
</a><a href="mailto:?subject=DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations&body=Check+out+this+article%3A+DynamoDB+with+TypeScript%3A+Type-Safe+NoSQL+Operations+-+https%3A%2F%2Fscottobert.com%2Fposts%2Fdynamodb-typescript%2F" class="floating-share-button email" title="Share via Email"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1.0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
</a><button type=button class="floating-share-button copy-link" data-url=https://scottobert.com/posts/dynamodb-typescript/ title="Copy link">
<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1.0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1.0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1.0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button></div></div><script>(function(){const s=document.getElementById("floating-share"),t=document.getElementById("share-toggle"),n=document.getElementById("share-buttons");if(!s||!t||!n)return;let e=!1,o;t.addEventListener("click",function(){e=!e,e?(n.classList.add("visible"),t.classList.add("active"),clearTimeout(o)):(n.classList.remove("visible"),t.classList.remove("active"))});function i(){clearTimeout(o),o=setTimeout(()=>{e&&(n.classList.remove("visible"),t.classList.remove("active"),e=!1)},5e3)}s.addEventListener("mouseenter",()=>{clearTimeout(o)}),s.addEventListener("mouseleave",()=>{e&&i()}),t.addEventListener("click",()=>{e&&i()});let l=0;const d=300;window.addEventListener("scroll",function(){const o=window.pageYOffset||document.documentElement.scrollTop;o>d?s.classList.add("visible"):(s.classList.remove("visible"),e&&(n.classList.remove("visible"),t.classList.remove("active"),e=!1)),l=o});const a=n.querySelector(".copy-link");a&&a.addEventListener("click",function(){const e=this.getAttribute("data-url");navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{c(this)}).catch(()=>{r(e,this)}):r(e,this)});function r(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),c(t)}catch(e){console.error("Fallback: Unable to copy",e)}document.body.removeChild(n)}function c(e){e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},2e3)}})()</script></main><aside class=blog-sidebar><div class=sidebar-widget><h3>Recent Posts</h3><ul class=recent-posts><li><a href=/posts/advanced-cloudformation-patterns/>Infrastructure as Code: Advanced CloudFormation Patterns</a>
<span class=post-date>Jun 13, 2025</span></li><li><a href=/posts/reverting-git-commits-safely/>Reverting Git Commits Safely: Undoing Changes Without Losing History</a>
<span class=post-date>Jun 11, 2025</span></li><li><a href=/posts/dynamodb-streams-opensearch-sync/>Real-time Data Synchronization: Using DynamoDB Streams and Lambda to Keep OpenSearch Indexes Current</a>
<span class=post-date>Jun 6, 2025</span></li><li><a href=/posts/using-ai-in-software-engineering/>Harnessing AI in Software Engineering: Opportunities and Challenges</a>
<span class=post-date>May 29, 2025</span></li><li><a href=/posts/aws-websockets-typescript/>Real-time Applications with AWS WebSockets and TypeScript</a>
<span class=post-date>Aug 13, 2023</span></li></ul></div><div class=sidebar-widget><h3>Post Series</h3><ul class=recent-posts><li><a href=/posts/aws-websockets-typescript/>AWS and Typescript: Real-time Applications with AWS WebSockets and TypeScript</a>
<span class=post-date>Aug 13, 2023</span><div class=series-meta><a href=/series/aws-and-typescript/ class=series-link>View all 7 posts in series →</a></div></li><li><a href=/posts/real-time-processing-architectures/>Cloud Architecture Patterns: Real-time Processing Architectures</a>
<span class=post-date>Apr 11, 2021</span><div class=series-meta><a href=/series/cloud-architecture-patterns/ class=series-link>View all 7 posts in series →</a></div></li><li><a href=/posts/technical-debt-management-growing-codebases/>Modern Development Practices: Technical Debt Management in Growing Codebases: Strategies for Sustainable Development</a>
<span class=post-date>Dec 19, 2021</span><div class=series-meta><a href=/series/modern-development-practices/ class=series-link>View all 7 posts in series →</a></div></li><li><a href=/posts/threat-modeling-cloud-applications/>Security in Cloud-Native Applications: Threat Modeling for Cloud Applications: A Comprehensive Approach to Security Design</a>
<span class=post-date>Oct 19, 2019</span><div class=series-meta><a href=/series/security-in-cloud-native-applications/ class=series-link>View all 7 posts in series →</a></div></li></ul></div><div class=sidebar-widget><h3>Categories</h3><ul class=categories><li><a href=/categories/api-development>api development (2)</a></li><li><a href=/categories/architecture>architecture (2)</a></li><li><a href=/categories/architecture-and-design>architecture and design (9)</a></li><li><a href=/categories/artificial-intelligence>artificial intelligence (1)</a></li><li><a href=/categories/cloud-computing>cloud computing (21)</a></li><li><a href=/categories/code-quality>code quality (1)</a></li><li><a href=/categories/compliance>compliance (1)</a></li><li><a href=/categories/cost-optimization>cost optimization (1)</a></li><li><a href=/categories/data-engineering>data engineering (3)</a></li><li><a href=/categories/database>database (1)</a></li><li><a href=/categories/database-design>database design (1)</a></li><li><a href=/categories/debugging-and-troubleshooting>debugging and troubleshooting (1)</a></li><li><a href=/categories/developer-experience>developer experience (1)</a></li><li><a href=/categories/development-tools>development tools (3)</a></li><li><a href=/categories/development-tutorials>development tutorials (1)</a></li><li><a href=/categories/infrastructure-as-code>infrastructure as code (1)</a></li><li><a href=/categories/microservices>microservices (1)</a></li><li><a href=/categories/performance>performance (1)</a></li><li><a href=/categories/quality-assurance>quality assurance (1)</a></li><li><a href=/categories/real-time-applications>real-time applications (1)</a></li><li><a href=/categories/security>security (8)</a></li><li><a href=/categories/serverless>serverless (2)</a></li><li><a href=/categories/software-development>software development (8)</a></li><li><a href=/categories/technical-debt>technical debt (1)</a></li><li><a href=/categories/testing>testing (2)</a></li><li><a href=/categories/version-control>version control (2)</a></li></ul></div><div class=sidebar-widget><h3>Tags</h3><div class=tag-cloud><a href=/tags/ai class=tag-cloud-item style=font-size:1rem>ai
</a><a href=/tags/api-design class=tag-cloud-item style=font-size:1rem>api design
</a><a href=/tags/api-gateway class=tag-cloud-item style=font-size:1rem>api gateway
</a><a href=/tags/api-security class=tag-cloud-item style=font-size:1rem>api security
</a><a href=/tags/architecture class=tag-cloud-item style=font-size:2rem>architecture
</a><a href=/tags/athena class=tag-cloud-item style=font-size:1rem>athena
</a><a href=/tags/authentication class=tag-cloud-item style=font-size:1rem>authentication
</a><a href=/tags/authorization class=tag-cloud-item style=font-size:1rem>authorization
</a><a href=/tags/automation class=tag-cloud-item style=font-size:1rem>automation
</a><a href=/tags/aws class=tag-cloud-item style=font-size:3rem>aws
</a><a href=/tags/aws-lambda class=tag-cloud-item style=font-size:1rem>aws lambda
</a><a href=/tags/best-practices class=tag-cloud-item style=font-size:2rem>best practices
</a><a href=/tags/cdk class=tag-cloud-item style=font-size:1rem>cdk
</a><a href=/tags/chaos-engineering class=tag-cloud-item style=font-size:1rem>chaos engineering
</a><a href=/tags/ci/cd class=tag-cloud-item style=font-size:1rem>ci/cd
</a><a href=/tags/cloud-native class=tag-cloud-item style=font-size:1rem>cloud native
</a><a href=/tags/cloudformation class=tag-cloud-item style=font-size:1rem>cloudformation
</a><a href=/tags/cloudnative class=tag-cloud-item style=font-size:1rem>cloudnative
</a><a href=/tags/code-quality class=tag-cloud-item style=font-size:1rem>code quality
</a><a href=/tags/communication-patterns class=tag-cloud-item style=font-size:1rem>communication patterns
</a><a href=/tags/compliance class=tag-cloud-item style=font-size:1rem>compliance
</a><a href=/tags/containers class=tag-cloud-item style=font-size:1rem>containers
</a><a href=/tags/cost-optimization class=tag-cloud-item style=font-size:1rem>cost optimization
</a><a href=/tags/cqrs class=tag-cloud-item style=font-size:1rem>cqrs
</a><a href=/tags/data-architecture class=tag-cloud-item style=font-size:1rem>data architecture
</a><a href=/tags/data-lake class=tag-cloud-item style=font-size:1rem>data lake
</a><a href=/tags/data-modeling class=tag-cloud-item style=font-size:1rem>data modeling
</a><a href=/tags/database class=tag-cloud-item style=font-size:1rem>database
</a><a href=/tags/database-design class=tag-cloud-item style=font-size:1rem>database design
</a><a href=/tags/debugging class=tag-cloud-item style=font-size:1rem>debugging
</a><a href=/tags/debugging-and-troubleshooting class=tag-cloud-item style=font-size:1rem>debugging and troubleshooting
</a><a href=/tags/developer-tips class=tag-cloud-item style=font-size:1rem>developer tips
</a><a href=/tags/development class=tag-cloud-item style=font-size:2rem>development
</a><a href=/tags/devops class=tag-cloud-item style=font-size:1rem>devops
</a><a href=/tags/devsecops class=tag-cloud-item style=font-size:1rem>devsecops
</a><a href=/tags/distributed-systems class=tag-cloud-item style=font-size:1rem>distributed systems
</a><a href=/tags/docker class=tag-cloud-item style=font-size:1rem>docker
</a><a href=/tags/dynamodb class=tag-cloud-item style=font-size:1rem>dynamodb
</a><a href=/tags/encryption class=tag-cloud-item style=font-size:1rem>encryption
</a><a href=/tags/enterprise-architecture class=tag-cloud-item style=font-size:1rem>enterprise architecture
</a><a href=/tags/event-sourcing class=tag-cloud-item style=font-size:1rem>event sourcing
</a><a href=/tags/event-driven-architecture class=tag-cloud-item style=font-size:1rem>event-driven architecture
</a><a href=/tags/eventbridge class=tag-cloud-item style=font-size:1rem>eventbridge
</a><a href=/tags/fault-tolerance class=tag-cloud-item style=font-size:1rem>fault tolerance
</a><a href=/tags/gdpr class=tag-cloud-item style=font-size:1rem>gdpr
</a><a href=/tags/git class=tag-cloud-item style=font-size:1rem>git
</a><a href=/tags/glue class=tag-cloud-item style=font-size:1rem>glue
</a><a href=/tags/governance class=tag-cloud-item style=font-size:1rem>governance
</a><a href=/tags/graphql class=tag-cloud-item style=font-size:1rem>graphql
</a><a href=/tags/hipaa class=tag-cloud-item style=font-size:1rem>hipaa
</a><a href=/tags/iam class=tag-cloud-item style=font-size:1rem>iam
</a><a href=/tags/identity-management class=tag-cloud-item style=font-size:1rem>identity management
</a><a href=/tags/infrastructure class=tag-cloud-item style=font-size:1rem>infrastructure
</a><a href=/tags/infrastructure-as-code class=tag-cloud-item style=font-size:1rem>infrastructure as code
</a><a href=/tags/jwt class=tag-cloud-item style=font-size:1rem>jwt
</a><a href=/tags/kinesis class=tag-cloud-item style=font-size:1rem>kinesis
</a><a href=/tags/kubernetes class=tag-cloud-item style=font-size:1rem>kubernetes
</a><a href=/tags/lambda class=tag-cloud-item style=font-size:1rem>lambda
</a><a href=/tags/load-testing class=tag-cloud-item style=font-size:1rem>load testing
</a><a href=/tags/metrics class=tag-cloud-item style=font-size:1rem>metrics
</a><a href=/tags/microservices class=tag-cloud-item style=font-size:1rem>microservices
</a><a href=/tags/monitoring class=tag-cloud-item style=font-size:1rem>monitoring
</a><a href=/tags/multi-account class=tag-cloud-item style=font-size:1rem>multi-account
</a><a href=/tags/nosql class=tag-cloud-item style=font-size:1rem>nosql
</a><a href=/tags/oauth class=tag-cloud-item style=font-size:1rem>oauth
</a><a href=/tags/octave class=tag-cloud-item style=font-size:1rem>octave
</a><a href=/tags/opensearch class=tag-cloud-item style=font-size:1rem>opensearch
</a><a href=/tags/pasta class=tag-cloud-item style=font-size:1rem>pasta
</a><a href=/tags/patterns class=tag-cloud-item style=font-size:1rem>patterns
</a><a href=/tags/pci-dss class=tag-cloud-item style=font-size:1rem>pci-dss
</a><a href=/tags/performance-testing class=tag-cloud-item style=font-size:1rem>performance testing
</a><a href=/tags/productivity class=tag-cloud-item style=font-size:1rem>productivity
</a><a href=/tags/rate-limiting class=tag-cloud-item style=font-size:1rem>rate limiting
</a><a href=/tags/real-time class=tag-cloud-item style=font-size:1rem>real-time
</a><a href=/tags/refactoring class=tag-cloud-item style=font-size:1rem>refactoring
</a><a href=/tags/reliability class=tag-cloud-item style=font-size:1rem>reliability
</a><a href=/tags/resilience class=tag-cloud-item style=font-size:1rem>resilience
</a><a href=/tags/rest class=tag-cloud-item style=font-size:1rem>rest
</a><a href=/tags/rest-api class=tag-cloud-item style=font-size:1rem>rest api
</a><a href=/tags/riskassessment class=tag-cloud-item style=font-size:1rem>riskassessment
</a><a href=/tags/s3 class=tag-cloud-item style=font-size:1rem>s3
</a><a href=/tags/search class=tag-cloud-item style=font-size:1rem>search
</a><a href=/tags/secrets-management class=tag-cloud-item style=font-size:1rem>secrets management
</a><a href=/tags/security class=tag-cloud-item style=font-size:2rem>security
</a><a href=/tags/securitydesign class=tag-cloud-item style=font-size:1rem>securitydesign
</a><a href=/tags/serverless class=tag-cloud-item style=font-size:2rem>serverless
</a><a href=/tags/soc2 class=tag-cloud-item style=font-size:1rem>soc2
</a><a href=/tags/software-engineering class=tag-cloud-item style=font-size:1rem>software engineering
</a><a href=/tags/standards class=tag-cloud-item style=font-size:1rem>standards
</a><a href=/tags/stream-processing class=tag-cloud-item style=font-size:1rem>stream processing
</a><a href=/tags/streams class=tag-cloud-item style=font-size:1rem>streams
</a><a href=/tags/stride class=tag-cloud-item style=font-size:1rem>stride
</a><a href=/tags/tdd class=tag-cloud-item style=font-size:1rem>tdd
</a><a href=/tags/technical-debt class=tag-cloud-item style=font-size:1rem>technical debt
</a><a href=/tags/testing class=tag-cloud-item style=font-size:1rem>testing
</a><a href=/tags/threatmodeling class=tag-cloud-item style=font-size:1rem>threatmodeling
</a><a href=/tags/typescript class=tag-cloud-item style=font-size:2rem>typescript
</a><a href=/tags/version-control class=tag-cloud-item style=font-size:1rem>version control
</a><a href=/tags/websockets class=tag-cloud-item style=font-size:1rem>websockets
</a><a href=/tags/zero-trust class=tag-cloud-item style=font-size:1rem>zero trust</a></div></div><div class=sidebar-widget><h3>Subscribe</h3><div class=subscribe-links><a href=/index.xml class=rss-link><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
RSS Feed</a></div></div><div class="sidebar-widget npm-packages"><h3>My NPM Packages</h3><div id=npm-list></div></div></aside></div></div><footer class=site-footer><div class=container><p>&copy; 2025 Scott Obert</p></div></footer></body></html>
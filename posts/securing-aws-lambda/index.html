<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Scott Obert</title><link rel=stylesheet href=/css/style.css><script src=/js/npm-packages.js defer></script><script defer src=https://cloud.umami.is/script.js data-website-id=e2461896-021d-422a-b83f-624a8819309b></script></head><body><header class=site-header><div class=container><div class=header-content><div class=header-left><h1><a href=/>Scott Obert</a></h1><nav><a href=/posts/>Blog</a>
<a href=/about/>About</a></nav></div><div class=social-links><a href=https://www.linkedin.com/in/scott-obert-3a7338b/ target=_blank rel="noopener noreferrer" title="LinkedIn Profile"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
<span>LinkedIn</span>
</a><a href=https://github.com/scottobert target=_blank rel="noopener noreferrer" title="GitHub Profile"><svg viewBox="0 0 24 24"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.335-1.755-1.335-1.755-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.605-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/></svg>
<span>GitHub</span></a></div></div></div></header><div class=container><div class=content-layout><main class=main-content><article class=post><h1>Securing AWS Lambda Functions: Best Practices and Implementation Guide</h1><div class=post-meta><span>Apr 7, 2023</span>
<span>| Tags: AWS, Security, Serverless, Development, Best Practices</span></div><div class=post-content><p>Following our exploration of AWS Lambda with TypeScript and Step Functions, it&rsquo;s crucial to understand how to properly secure your serverless applications. Security in serverless architectures requires a different approach from traditional applications, as the infrastructure is managed by AWS while you maintain responsibility for securing your application logic and data.</p><h2 id=understanding-the-shared-responsibility-model>Understanding the Shared Responsibility Model</h2><p>In the AWS Lambda context, the shared responsibility model takes on a unique form. AWS handles the security of the runtime environment, execution environment isolation, and underlying infrastructure. However, developers are responsible for securing their application code, managing IAM permissions, protecting sensitive data, and ensuring secure communication between services. This division of responsibility allows you to focus on application-specific security while AWS handles the infrastructure security.</p><h2 id=iam-role-configuration>IAM Role Configuration</h2><p>Proper IAM role configuration forms the foundation of Lambda security. Instead of using broad permissions, your Lambda functions should follow the principle of least privilege. Each function should have a dedicated IAM role with only the permissions it needs to perform its specific tasks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># template.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ProcessOrderFunction</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>src/functions/processOrder.handler</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>nodejs18.x</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Policies</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>DynamoDBCrudPolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>TableName</span>: !<span style=color:#ae81ff>Ref OrdersTable</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>SQSPollerPolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>QueueName</span>: !<span style=color:#ae81ff>GetAtt OrderQueue.QueueName</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>SSMParameterReadPolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>ParameterName</span>: <span style=color:#ae81ff>/app/orders/config</span>
</span></span></code></pre></div><p>This configuration demonstrates granular permission control, allowing the function to only access specific DynamoDB tables, SQS queues, and SSM parameters it needs for operation.</p><h2 id=securing-environment-variables>Securing Environment Variables</h2><p>Sensitive configuration values should never be hardcoded in your function code. AWS Lambda provides encrypted environment variables, but you should take additional steps to enhance their security:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/config/secrets.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SSM</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecretManager</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>ssm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SSM</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>cache</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>string</span>&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getSecret</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>string</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>name</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cache</span>.<span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>name</span>)<span style=color:#f92672>!</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parameter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ssm</span>.<span style=color:#a6e22e>getParameter</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Name</span>: <span style=color:#66d9ef>name</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>WithDecryption</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }).<span style=color:#a6e22e>promise</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>parameter</span>.<span style=color:#a6e22e>Parameter</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>Value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Secret </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74> not found`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cache</span>.<span style=color:#66d9ef>set</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=network-security>Network Security</h2><p>Network security for Lambda functions requires careful consideration of VPC configuration, network access controls, and security group rules. While Lambda functions run in AWS-managed VPCs by default (which is sufficient for many use cases), you might need to run your functions in your own VPC when they need to access private resources like RDS databases, ElastiCache clusters, or internal services running on EC2 instances.</p><p>When deploying Lambda functions to a VPC, configure them in private subnets with a NAT Gateway for external internet access. Here&rsquo;s how to set up the networking configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># template.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ProcessOrderFunction</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>src/functions/processOrder.handler</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>nodejs18.x</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Environment</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Variables</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>SECURITY_GROUP_IDS</span>: !<span style=color:#ae81ff>Ref LambdaSecurityGroup</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>SUBNET_IDS</span>: !<span style=color:#ae81ff>Join [&#39;,&#39;, [!Ref PrivateSubnet1, !Ref PrivateSubnet2]]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>VPC_ID</span>: !<span style=color:#ae81ff>Ref VPC</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>VpcConfig</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>SecurityGroupIds</span>:
</span></span><span style=display:flex><span>          - !<span style=color:#ae81ff>Ref LambdaSecurityGroup</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>SubnetIds</span>:
</span></span><span style=display:flex><span>          - !<span style=color:#ae81ff>Ref PrivateSubnet1</span>
</span></span><span style=display:flex><span>          - !<span style=color:#ae81ff>Ref PrivateSubnet2</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>  <span style=color:#f92672>LambdaSecurityGroup</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::EC2::SecurityGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>GroupDescription</span>: <span style=color:#ae81ff>Security group for Lambda function</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>VpcId</span>: !<span style=color:#ae81ff>Ref VPC</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SecurityGroupIngress</span>: []  <span style=color:#75715e># No inbound rules needed for Lambda</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SecurityGroupEgress</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>IpProtocol</span>: <span style=color:#ae81ff>tcp</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>FromPort</span>: <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ToPort</span>: <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>CidrIp</span>: <span style=color:#ae81ff>0.0.0.0</span><span style=color:#ae81ff>/0 </span> <span style=color:#75715e># Allow HTTPS outbound</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>IpProtocol</span>: <span style=color:#ae81ff>tcp</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>FromPort</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ToPort</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>DestinationSecurityGroupId</span>: !<span style=color:#ae81ff>Ref DatabaseSecurityGroup </span> <span style=color:#75715e># Allow MySQL access</span>
</span></span></code></pre></div><p>In your TypeScript code, create a reusable configuration for VPC settings:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/utils/networkConfig.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>VpcConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk/clients/lambda&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NetworkConfiguration</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getVpcConfig</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>VpcConfig</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If using SSM Parameter Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>VPC_CONFIG_PARAMETER</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ssm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AWS</span>.<span style=color:#a6e22e>SSM</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parameter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>ssm</span>.<span style=color:#a6e22e>getParameter</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Name</span>: <span style=color:#66d9ef>process.env.VPC_CONFIG_PARAMETER</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>WithDecryption</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      }).<span style=color:#a6e22e>promise</span>();
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>securityGroupId</span>, ...<span style=color:#a6e22e>subnetIds</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>parameter</span>.<span style=color:#a6e22e>Parameter</span><span style=color:#f92672>!</span>.<span style=color:#a6e22e>Value</span><span style=color:#f92672>!</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>securityGroupIds</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>securityGroupId</span>],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>subnetIds</span>: <span style=color:#66d9ef>subnetIds</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>enableDualStack</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If using environment variables directly
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SECURITY_GROUP_IDS</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SUBNET_IDS</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Missing VPC configuration&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>securityGroupIds</span>: <span style=color:#66d9ef>process.env.SECURITY_GROUP_IDS.split</span>(<span style=color:#e6db74>&#39;,&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>subnetIds</span>: <span style=color:#66d9ef>process.env.SUBNET_IDS.split</span>(<span style=color:#e6db74>&#39;,&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>enableDualStack</span>: <span style=color:#66d9ef>true</span>  <span style=color:#75715e>// Enable IPv6 support if your VPC supports it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>validateVpcConfig</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getVpcConfig</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>subnetIds</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;At least two subnets required for high availability&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>securityGroupIds</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;At least one security group required&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>When using this configuration in your Lambda functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/functions/databaseAccess.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NetworkConfiguration</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../utils/networkConfig&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>RDS</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Validate VPC configuration before attempting database access
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>NetworkConfiguration</span>.<span style=color:#a6e22e>validateVpcConfig</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RDS</span>({
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>NetworkConfiguration</span>.<span style=color:#a6e22e>getVpcConfig</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>region</span>: <span style=color:#66d9ef>process.env.AWS_REGION</span>
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Your database interaction code here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span></code></pre></div><p>The VPC configuration is set both at the infrastructure level in the <code>VpcConfig</code> property and exposed to the Lambda function through environment variables. This dual configuration serves two purposes:</p><ol><li>The <code>VpcConfig</code> property tells AWS where to place the Lambda function in your VPC</li><li>The environment variables allow your function code to access and validate the VPC configuration at runtime</li></ol><p>Note that while we&rsquo;re setting these values directly as environment variables in this example, in a production environment, you might want to store them in AWS Systems Manager Parameter Store or AWS Secrets Manager, especially if they need to be rotated or shared across multiple functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># template.yaml additional configuration</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>VpcConfigParameter</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::SSM::Parameter</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Name</span>: <span style=color:#ae81ff>/app/network/vpc-config</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>String</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Value</span>: !<span style=color:#ae81ff>Join </span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;,&#39;</span>
</span></span><span style=display:flex><span>        - - !<span style=color:#ae81ff>Ref LambdaSecurityGroup</span>
</span></span><span style=display:flex><span>          - !<span style=color:#ae81ff>Ref PrivateSubnet1</span>
</span></span><span style=display:flex><span>          - !<span style=color:#ae81ff>Ref PrivateSubnet2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Description</span>: <span style=color:#ae81ff>VPC configuration for Lambda functions</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ProcessOrderFunction</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># ... existing function configuration ...</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Environment</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Variables</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>VPC_CONFIG_PARAMETER</span>: !<span style=color:#ae81ff>Ref VpcConfigParameter</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Policies</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>SSMParameterReadPolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>ParameterName</span>: !<span style=color:#ae81ff>Ref VpcConfigParameter</span>
</span></span></code></pre></div><p>Remember these key networking security considerations:</p><ol><li>Always deploy Lambda functions that access private resources (like databases) in private subnets</li><li>Configure security groups to allow only necessary outbound traffic</li><li>Use AWS PrivateLink for secure access to AWS services without internet exposure</li><li>Enable VPC Flow Logs for network traffic monitoring and security analysis</li><li>Consider using AWS Network Firewall for additional network security controls</li></ol><p>The network configuration should be defined in your Infrastructure as Code (IaC) templates and passed to the Lambda functions through environment variables or AWS Systems Manager Parameter Store.</p><h2 id=input-validation-and-sanitization>Input Validation and Sanitization</h2><p>Thorough input validation is essential for preventing injection attacks and ensuring data integrity. Implement validation at the API Gateway level and within your Lambda functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/validation/orderValidator.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>z</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;zod&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>OrderSchema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>z</span>.<span style=color:#66d9ef>object</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>z.string</span>().<span style=color:#a6e22e>uuid</span>(),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>customerId</span>: <span style=color:#66d9ef>z.string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>z.array</span>(<span style=color:#a6e22e>z</span>.<span style=color:#66d9ef>object</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>z.string</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>quantity</span>: <span style=color:#66d9ef>z.number</span>().<span style=color:#a6e22e>positive</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>z.number</span>().<span style=color:#a6e22e>positive</span>()
</span></span><span style=display:flex><span>  })),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>totalAmount</span>: <span style=color:#66d9ef>z.number</span>().<span style=color:#a6e22e>positive</span>()
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validateOrder</span>(<span style=color:#a6e22e>input</span>: <span style=color:#66d9ef>unknown</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OrderSchema</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>input</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Validation error:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=implementing-secure-http-communication>Implementing Secure HTTP Communication</h2><p>When your Lambda functions communicate with external services, implement proper security measures for HTTP communications:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/utils/httpClient.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>axios</span>, { <span style=color:#a6e22e>AxiosInstance</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;axios&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>https</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;https&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecureHttpClient</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>client</span>: <span style=color:#66d9ef>AxiosInstance</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>baseURL</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>create</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>baseURL</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>httpsAgent</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>Agent</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rejectUnauthorized</span>: <span style=color:#66d9ef>true</span>,  <span style=color:#75715e>// Ensure SSL/TLS verification
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>minVersion</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;TLSv1.2&#39;</span>      <span style=color:#75715e>// Enforce minimum TLS version
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      }),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>timeout</span>: <span style=color:#66d9ef>5000</span>,               <span style=color:#75715e>// Set reasonable timeouts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;X-Api-Version&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1.0&#39;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>get</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>url</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#66d9ef>get</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>post</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>url</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>unknown</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>T</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>post</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=logging-and-monitoring-for-security>Logging and Monitoring for Security</h2><p>Implementing comprehensive logging and monitoring helps detect and respond to security incidents. Configure your functions to log security-relevant events:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/utils/securityLogger.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CloudWatch</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityLogger</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>cloudwatch</span>: <span style=color:#66d9ef>CloudWatch</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> <span style=color:#66d9ef>namespace</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>namespace</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cloudwatch</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CloudWatch</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#66d9ef>namespace</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>namespace</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>logSecurityEvent</span>(<span style=color:#a6e22e>eventType</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>details</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>unknown</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Security event:&#39;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eventType</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>timestamp</span>,
</span></span><span style=display:flex><span>      ...<span style=color:#a6e22e>details</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cloudwatch</span>.<span style=color:#a6e22e>putMetricData</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Namespace</span>: <span style=color:#66d9ef>this.namespace</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>MetricData</span><span style=color:#f92672>:</span> [{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>MetricName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`SecurityEvent_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>eventType</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Value</span>: <span style=color:#66d9ef>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Timestamp</span>: <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Dimensions</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Environment&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Value</span>: <span style=color:#66d9ef>process.env.ENVIRONMENT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;development&#39;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>      }]
</span></span><span style=display:flex><span>    }).<span style=color:#a6e22e>promise</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=dependency-security>Dependency Security</h2><p>Managing dependencies securely is crucial for maintaining the overall security of your Lambda functions. Implement a process for regularly updating and scanning dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// package.json
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;audit&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;npm audit &amp;&amp; npm outdated&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;update-deps&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;npm update --save&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;security-scan&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;snyk test&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=error-handling-and-security>Error Handling and Security</h2><p>Implement secure error handling to prevent information disclosure while maintaining observability:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/utils/errorHandler.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityError</span> <span style=color:#66d9ef>extends</span> Error {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> <span style=color:#a6e22e>securityContext</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>unknown</span>&gt;
</span></span><span style=display:flex><span>  ) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SecurityError&#39;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>getSecureMessage</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Return sanitized error message for external users
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;An error occurred processing your request&#39;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>logError</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Log detailed error information for internal use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Security error:&#39;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>this.message</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>context</span>: <span style=color:#66d9ef>this.securityContext</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>stack</span>: <span style=color:#66d9ef>this.stack</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=rate-limiting-and-dos-protection>Rate Limiting and DoS Protection</h2><p>Protect your Lambda functions from abuse by implementing rate limiting and other protective measures:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/middleware/rateLimiter.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamoDB</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-sdk&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RateLimiter</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>dynamodb</span>: <span style=color:#66d9ef>DynamoDB.DocumentClient</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> <span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>tableName</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dynamodb</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDB</span>.<span style=color:#a6e22e>DocumentClient</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tableName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableName</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>checkLimit</span>(<span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>limit</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>windowSeconds</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>boolean</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> Date.<span style=color:#a6e22e>now</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>windowStart</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>-</span> (<span style=color:#a6e22e>windowSeconds</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dynamodb</span>.<span style=color:#a6e22e>update</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>TableName</span>: <span style=color:#66d9ef>this.tableName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Key</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>key</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>UpdateExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SET requests = list_append(if_not_exists(requests, :empty), :request)&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpressionAttributeValues</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;:request&#39;</span><span style=color:#f92672>:</span> [[<span style=color:#a6e22e>now</span>]],
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;:empty&#39;</span><span style=color:#f92672>:</span> []
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ReturnValues</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ALL_NEW&#39;</span>
</span></span><span style=display:flex><span>      }).<span style=color:#a6e22e>promise</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>requests</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Attributes</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>requests</span> <span style=color:#f92672>||</span> [];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>recentRequests</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>requests</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>r</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>r</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>windowStart</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>recentRequests</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>limit</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Rate limiting error:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Securing AWS Lambda functions requires a comprehensive approach that addresses multiple layers of security. By implementing proper IAM roles, securing environment variables, validating input, and monitoring security events, you can build robust and secure serverless applications. Remember that security is an ongoing process that requires regular review and updates as new threats emerge and best practices evolve.</p><p>Moving forward, consider implementing additional security measures such as AWS WAF integration for API Gateway endpoints, AWS Shield for DDoS protection, and AWS Security Hub for centralized security monitoring. Regular security audits and penetration testing will help ensure your Lambda functions remain secure as your application evolves.</p></div></article></main><aside class=blog-sidebar><div class=sidebar-widget><h3>Recent Posts</h3><ul class=recent-posts><li><a href=/posts/using-ai-in-software-engineering/>Harnessing AI in Software Engineering: Opportunities and Challenges</a>
<span class=post-date>May 29, 2025</span></li><li><a href=/posts/aws-serverless-cost-optimization/>Cost Optimization Strategies for AWS Serverless Applications</a>
<span class=post-date>Jun 17, 2023</span></li><li><a href=/posts/aws-sns-sqs-typescript/>Building Event-Driven Architectures with AWS SNS/SQS and TypeScript</a>
<span class=post-date>May 21, 2023</span></li><li><a href=/posts/securing-aws-lambda/>Securing AWS Lambda Functions: Best Practices and Implementation Guide</a>
<span class=post-date>Apr 7, 2023</span></li><li><a href=/posts/aws-step-functions-typescript/>Step Functions: Orchestrating AWS Lambda Workflows in TypeScript</a>
<span class=post-date>Mar 5, 2023</span></li></ul></div><div class=sidebar-widget><h3>Categories</h3><ul class=categories><li><a href=/categories/architecture>architecture (1)</a></li><li><a href=/categories/architecture-and-design>architecture and design (7)</a></li><li><a href=/categories/artificial-intelligence>artificial intelligence (1)</a></li><li><a href=/categories/cloud-computing>cloud computing (11)</a></li><li><a href=/categories/code-quality>code quality (1)</a></li><li><a href=/categories/cost-optimization>cost optimization (1)</a></li><li><a href=/categories/data-engineering>data engineering (2)</a></li><li><a href=/categories/database>database (1)</a></li><li><a href=/categories/debugging-and-troubleshooting>debugging and troubleshooting (1)</a></li><li><a href=/categories/development-tools>development tools (2)</a></li><li><a href=/categories/development-tutorials>development tutorials (1)</a></li><li><a href=/categories/microservices>microservices (1)</a></li><li><a href=/categories/performance>performance (1)</a></li><li><a href=/categories/quality-assurance>quality assurance (1)</a></li><li><a href=/categories/security>security (1)</a></li><li><a href=/categories/serverless>serverless (1)</a></li><li><a href=/categories/software-development>software development (8)</a></li><li><a href=/categories/technical-debt>technical debt (1)</a></li><li><a href=/categories/testing>testing (2)</a></li><li><a href=/categories/version-control>version control (1)</a></li></ul></div><div class=sidebar-widget><h3>Post Series</h3><ul class=recent-posts><li><a href=/posts/real-time-processing-architectures/>Cloud Architecture Patterns: Real-time Processing Architectures</a>
<span class=post-date>Apr 11, 2021</span><div class=series-meta><a href=/series/cloud-architecture-patterns/ class=series-link>View all 7 posts in series →</a></div></li><li><a href=/posts/technical-debt-management-growing-codebases/>Modern Development Practices: Technical Debt Management in Growing Codebases: Strategies for Sustainable Development</a>
<span class=post-date>Dec 19, 2021</span><div class=series-meta><a href=/series/modern-development-practices/ class=series-link>View all 7 posts in series →</a></div></li></ul></div><div class=sidebar-widget><h3>Tags</h3><div class=tag-cloud><a href=/tags/ai class=tag-cloud-item style=font-size:1rem>ai
</a><a href=/tags/api-design class=tag-cloud-item style=font-size:1rem>api design
</a><a href=/tags/architecture class=tag-cloud-item style=font-size:1rem>architecture
</a><a href=/tags/athena class=tag-cloud-item style=font-size:1rem>athena
</a><a href=/tags/automation class=tag-cloud-item style=font-size:1rem>automation
</a><a href=/tags/aws class=tag-cloud-item style=font-size:2rem>aws
</a><a href=/tags/best-practices class=tag-cloud-item style=font-size:1rem>best practices
</a><a href=/tags/chaos-engineering class=tag-cloud-item style=font-size:1rem>chaos engineering
</a><a href=/tags/ci/cd class=tag-cloud-item style=font-size:1rem>ci/cd
</a><a href=/tags/code-quality class=tag-cloud-item style=font-size:1rem>code quality
</a><a href=/tags/communication-patterns class=tag-cloud-item style=font-size:1rem>communication patterns
</a><a href=/tags/cost-optimization class=tag-cloud-item style=font-size:1rem>cost optimization
</a><a href=/tags/cqrs class=tag-cloud-item style=font-size:1rem>cqrs
</a><a href=/tags/data-architecture class=tag-cloud-item style=font-size:1rem>data architecture
</a><a href=/tags/data-lake class=tag-cloud-item style=font-size:1rem>data lake
</a><a href=/tags/data-modeling class=tag-cloud-item style=font-size:1rem>data modeling
</a><a href=/tags/database-design class=tag-cloud-item style=font-size:1rem>database design
</a><a href=/tags/debugging class=tag-cloud-item style=font-size:1rem>debugging
</a><a href=/tags/developer-tips class=tag-cloud-item style=font-size:1rem>developer tips
</a><a href=/tags/development class=tag-cloud-item style=font-size:2rem>development
</a><a href=/tags/distributed-systems class=tag-cloud-item style=font-size:1rem>distributed systems
</a><a href=/tags/dynamodb class=tag-cloud-item style=font-size:1rem>dynamodb
</a><a href=/tags/enterprise-architecture class=tag-cloud-item style=font-size:1rem>enterprise architecture
</a><a href=/tags/event-sourcing class=tag-cloud-item style=font-size:1rem>event sourcing
</a><a href=/tags/event-driven-architecture class=tag-cloud-item style=font-size:1rem>event-driven architecture
</a><a href=/tags/eventbridge class=tag-cloud-item style=font-size:1rem>eventbridge
</a><a href=/tags/fault-tolerance class=tag-cloud-item style=font-size:1rem>fault tolerance
</a><a href=/tags/glue class=tag-cloud-item style=font-size:1rem>glue
</a><a href=/tags/graphql class=tag-cloud-item style=font-size:1rem>graphql
</a><a href=/tags/kinesis class=tag-cloud-item style=font-size:1rem>kinesis
</a><a href=/tags/lambda class=tag-cloud-item style=font-size:1rem>lambda
</a><a href=/tags/load-testing class=tag-cloud-item style=font-size:1rem>load testing
</a><a href=/tags/metrics class=tag-cloud-item style=font-size:1rem>metrics
</a><a href=/tags/microservices class=tag-cloud-item style=font-size:1rem>microservices
</a><a href=/tags/monitoring class=tag-cloud-item style=font-size:1rem>monitoring
</a><a href=/tags/multi-account class=tag-cloud-item style=font-size:1rem>multi-account
</a><a href=/tags/nosql class=tag-cloud-item style=font-size:1rem>nosql
</a><a href=/tags/patterns class=tag-cloud-item style=font-size:1rem>patterns
</a><a href=/tags/performance-testing class=tag-cloud-item style=font-size:1rem>performance testing
</a><a href=/tags/productivity class=tag-cloud-item style=font-size:1rem>productivity
</a><a href=/tags/real-time class=tag-cloud-item style=font-size:1rem>real-time
</a><a href=/tags/refactoring class=tag-cloud-item style=font-size:1rem>refactoring
</a><a href=/tags/reliability class=tag-cloud-item style=font-size:1rem>reliability
</a><a href=/tags/resilience class=tag-cloud-item style=font-size:1rem>resilience
</a><a href=/tags/rest class=tag-cloud-item style=font-size:1rem>rest
</a><a href=/tags/s3 class=tag-cloud-item style=font-size:1rem>s3
</a><a href=/tags/security class=tag-cloud-item style=font-size:1rem>security
</a><a href=/tags/serverless class=tag-cloud-item style=font-size:1rem>serverless
</a><a href=/tags/software-engineering class=tag-cloud-item style=font-size:1rem>software engineering
</a><a href=/tags/standards class=tag-cloud-item style=font-size:1rem>standards
</a><a href=/tags/stream-processing class=tag-cloud-item style=font-size:1rem>stream processing
</a><a href=/tags/tdd class=tag-cloud-item style=font-size:1rem>tdd
</a><a href=/tags/technical-debt class=tag-cloud-item style=font-size:1rem>technical debt
</a><a href=/tags/testing class=tag-cloud-item style=font-size:1rem>testing
</a><a href=/tags/typescript class=tag-cloud-item style=font-size:2rem>typescript</a></div></div><div class=sidebar-widget><h3>Subscribe</h3><div class=subscribe-links><a href=/index.xml class=rss-link><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
RSS Feed</a></div></div><div class=sidebar-widget><h3>Archives</h3><ul class=archive-list></ul></div><div class="sidebar-widget npm-packages"><h3>My NPM Packages</h3><div id=npm-list></div></div></aside></div></div><footer class=site-footer><div class=container><p>&copy; 2025 Scott Obert</p></div></footer></body></html>
<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Scott Obert</title><link rel=stylesheet href=/css/style.css><script src=/js/npm-packages.js defer></script></head><body><header class=site-header><div class=container><div class=header-content><div class=header-left><h1><a href=/>Scott Obert</a></h1><nav><a href=/posts/>Blog</a></nav></div><div class=social-links><a href=https://www.linkedin.com/in/scott-obert-3a7338b/ target=_blank rel="noopener noreferrer" title="LinkedIn Profile"><svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
<span>LinkedIn</span></a></div></div></div></header><div class=container><div class=content-layout><main class=main-content><article class=post><h1>Step Functions: Orchestrating AWS Lambda Workflows in TypeScript</h1><div class=post-meta><span>Mar 5, 2023</span>
<span>| Tags: AWS, TypeScript, Serverless, Development, Architecture</span></div><div class=post-content><p>Building on our previous exploration of AWS Lambda with TypeScript, let&rsquo;s dive into how Step Functions can orchestrate complex workflows across multiple Lambda functions. Step Functions provide a reliable way to coordinate distributed components and handle long-running processes in your serverless applications.</p><h2 id=why-step-functions>Why Step Functions?</h2><p>While individual Lambda functions excel at discrete tasks, real-world applications demand more sophisticated orchestration capabilities. Applications typically need to manage complex workflows with multiple interconnected steps, implement comprehensive error handling and retry logic, and handle processes that extend beyond Lambda&rsquo;s 15-minute execution limit. Additionally, maintaining state between steps and coordinating parallel task execution are common requirements in distributed systems. Step Functions address these challenges by providing a robust state machine-based orchestration service that brings structure and reliability to complex serverless workflows.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we begin, you&rsquo;ll need to prepare your development environment. Make sure you have the AWS SAM CLI installed for local development and testing. You should have a TypeScript development environment set up and the AWS CLI configured with your credentials. Additionally, you should be familiar with AWS Lambda conceptsâ€”if you need a refresher, refer to our previous post on AWS Lambda with TypeScript for the fundamentals.</p><h2 id=creating-a-basic-workflow>Creating a Basic Workflow</h2><p>Let&rsquo;s create a practical example: an order processing system that demonstrates common patterns in distributed systems.</p><h3 id=1-define-your-state-machine>1. Define Your State Machine</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># template.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#39;2010-09-09&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Transform</span>: <span style=color:#ae81ff>AWS::Serverless-2016-10-31</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>OrderProcessingStateMachine</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::StateMachine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DefinitionUri</span>: <span style=color:#ae81ff>statemachine/order-processing.asl.json</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>STANDARD</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Policies</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>LambdaInvokePolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>FunctionName</span>: !<span style=color:#ae81ff>Ref ValidateOrderFunction</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>LambdaInvokePolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>FunctionName</span>: !<span style=color:#ae81ff>Ref ProcessPaymentFunction</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>LambdaInvokePolicy</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>FunctionName</span>: !<span style=color:#ae81ff>Ref FulfillOrderFunction</span>
</span></span></code></pre></div><h3 id=2-state-machine-definition>2. State Machine Definition</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Comment&#34;</span>: <span style=color:#e6db74>&#34;Order Processing Workflow&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;StartAt&#34;</span>: <span style=color:#e6db74>&#34;ValidateOrder&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;States&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ValidateOrder&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;${ValidateOrderFunctionArn}&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Next&#34;</span>: <span style=color:#e6db74>&#34;ProcessPayment&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Catch&#34;</span>: [{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ErrorEquals&#34;</span>: [<span style=color:#e6db74>&#34;ValidationError&#34;</span>],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Next&#34;</span>: <span style=color:#e6db74>&#34;OrderFailed&#34;</span>
</span></span><span style=display:flex><span>      }]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ProcessPayment&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;${ProcessPaymentFunctionArn}&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Next&#34;</span>: <span style=color:#e6db74>&#34;FulfillOrder&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Retry&#34;</span>: [{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ErrorEquals&#34;</span>: [<span style=color:#e6db74>&#34;ServiceError&#34;</span>],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;IntervalSeconds&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;MaxAttempts&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;BackoffRate&#34;</span>: <span style=color:#ae81ff>1.5</span>
</span></span><span style=display:flex><span>      }]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;FulfillOrder&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;${FulfillOrderFunctionArn}&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;End&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;OrderFailed&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Fail&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Cause&#34;</span>: <span style=color:#e6db74>&#34;Order processing failed&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-implementing-lambda-functions-in-typescript>3. Implementing Lambda Functions in TypeScript</h3><p>First, let&rsquo;s create our shared types:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/types/order.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Order</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>customerId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>OrderItem</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>totalAmount</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderItem</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>quantity</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>OrderStatus</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>PENDING</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;PENDING&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>VALIDATED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;VALIDATED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>PAID</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;PAID&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>FULFILLED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;FULFILLED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>FAILED</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;FAILED&#39;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, let&rsquo;s implement our Lambda functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/functions/validateOrder.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Order</span>, <span style=color:#a6e22e>OrderStatus</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/order&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ValidationError</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../errors&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>Order</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Validating order:&#39;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>orderId</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Validate order items and stock availability
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isValid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>validateOrderItems</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>items</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isValid</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ValidationError</span>(<span style=color:#e6db74>&#39;Order validation failed&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>event</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus.VALIDATED</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// src/functions/processPayment.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Order</span>, <span style=color:#a6e22e>OrderStatus</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../types/order&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PaymentService</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../services/payment&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>Order</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>paymentService</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentService</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>paymentService</span>.<span style=color:#a6e22e>processPayment</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>event.totalAmount</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>customerId</span>: <span style=color:#66d9ef>event.customerId</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>event.orderId</span>
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>event</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>status</span>: <span style=color:#66d9ef>OrderStatus.PAID</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=error-handling-and-retries>Error Handling and Retries</h2><p>Step Functions provide robust error handling capabilities:</p><ol><li><strong>State-Level Retries</strong>: Configure retry policies for transient failures</li><li><strong>Catch Blocks</strong>: Handle specific errors and route to error states</li><li><strong>Global Error Handling</strong>: Define default error handlers</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Example error handling in ProcessPayment function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>Order</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... payment processing logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isTransientError</span>(<span style=color:#a6e22e>error</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Step Functions will handle retry based on configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ServiceError</span>(<span style=color:#e6db74>&#39;Temporary payment service error&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Permanent failure
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Payment failed&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=advanced-patterns>Advanced Patterns</h2><h3 id=parallel-processing>Parallel Processing</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Parallel&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Branches&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;StartAt&#34;</span>: <span style=color:#e6db74>&#34;UpdateInventory&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;States&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;UpdateInventory&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;${UpdateInventoryFunctionArn}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;End&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;StartAt&#34;</span>: <span style=color:#e6db74>&#34;SendNotification&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;States&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;SendNotification&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Task&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;${SendNotificationFunctionArn}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;End&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Next&#34;</span>: <span style=color:#e6db74>&#34;CompleteOrder&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=choice-states>Choice States</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;Choice&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Choices&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Variable&#34;</span>: <span style=color:#e6db74>&#34;$.order.totalAmount&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;NumericGreaterThan&#34;</span>: <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Next&#34;</span>: <span style=color:#e6db74>&#34;RequireAdditionalApproval&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Default&#34;</span>: <span style=color:#e6db74>&#34;StandardProcessing&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=monitoring-and-debugging>Monitoring and Debugging</h2><ol><li><strong>X-Ray Integration</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>AWSXRay</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;aws-xray-sdk&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Enable X-Ray tracing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>aws</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AWSXRay</span>.<span style=color:#a6e22e>captureAWS</span>(<span style=color:#66d9ef>require</span>(<span style=color:#e6db74>&#39;aws-sdk&#39;</span>));
</span></span></code></pre></div><ol start=2><li><strong>CloudWatch Metrics</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>createCloudWatchMetric</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>metricName</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>number</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cloudwatch</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>CloudWatch</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cloudwatch</span>.<span style=color:#a6e22e>putMetricData</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MetricData</span><span style=color:#f92672>:</span> [{
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>MetricName</span>: <span style=color:#66d9ef>metricName</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Value</span>: <span style=color:#66d9ef>value</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Unit</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Count&#39;</span>
</span></span><span style=display:flex><span>    }],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Namespace</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;OrderProcessing&#39;</span>
</span></span><span style=display:flex><span>  }).<span style=color:#a6e22e>promise</span>();
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=best-practices>Best Practices</h2><p>When designing state machines, focus on keeping them simple and focused on specific business workflows. Take advantage of Step Functions&rsquo; built-in error handling capabilities rather than implementing custom error handling, and ensure your Lambda functions are idempotent to handle potential retries gracefully.</p><p>Your development workflow should leverage TypeScript&rsquo;s type safety features to catch potential errors early in the development cycle. Implement comprehensive logging throughout your functions to aid in debugging and troubleshooting. Using AWS SAM for local testing will help you iterate quickly and catch issues before deployment.</p><p>For production systems, implement a robust monitoring strategy. Set up CloudWatch alarms to alert on key metrics and failures, utilize X-Ray for distributed tracing to understand system behavior, and ensure proper error reporting is in place to quickly identify and resolve issues.</p><h2 id=conclusion>Conclusion</h2><p>Step Functions provide a powerful way to orchestrate serverless applications while maintaining clarity and reliability. When combined with TypeScript and proper error handling, they enable robust distributed systems that are easy to maintain and monitor.</p><p>As you continue developing with Step Functions, consider expanding your implementation by exploring Map states for dynamic parallel processing scenarios. Implementing distributed tracing will give you deeper insights into your workflow execution. Adding detailed CloudWatch metrics will help you monitor system health and performance. Finally, consider implementing compensation transactions for more complex workflows that require rollback capabilities in case of failures.</p><p>The complete code for this example is available on GitHub [add your repo link].</p><p>Feel free to share your experiences with Step Functions in the comments below!</p></div></article></main><aside class=blog-sidebar><div class=sidebar-widget><h3>Recent Posts</h3><ul class=recent-posts><li><a href=/posts/using-ai-in-software-engineering/>Harnessing AI in Software Engineering: Opportunities and Challenges</a>
<span class=post-date>May 29, 2025</span></li><li><a href=/posts/aws-sns-sqs-typescript/>Building Event-Driven Architectures with AWS SNS/SQS and TypeScript</a>
<span class=post-date>May 21, 2023</span></li><li><a href=/posts/securing-aws-lambda/>Securing AWS Lambda Functions: Best Practices and Implementation Guide</a>
<span class=post-date>Apr 7, 2023</span></li><li><a href=/posts/aws-step-functions-typescript/>Step Functions: Orchestrating AWS Lambda Workflows in TypeScript</a>
<span class=post-date>Mar 5, 2023</span></li><li><a href=/posts/aws-lambda-typescript/>How to deploy an AWS Lambda function written in TypeScript using SAM CLI</a>
<span class=post-date>Feb 17, 2023</span></li></ul></div><div class=sidebar-widget><h3>Categories</h3><ul class=categories></ul></div><div class=sidebar-widget><h3>Tags</h3><div class=tag-cloud><a href=/tags/ai class=tag-cloud-item style=font-size:1rem>ai
</a><a href=/tags/architecture class=tag-cloud-item style=font-size:1rem>architecture
</a><a href=/tags/automation class=tag-cloud-item style=font-size:1rem>automation
</a><a href=/tags/aws class=tag-cloud-item style=font-size:1rem>aws
</a><a href=/tags/best-practices class=tag-cloud-item style=font-size:1rem>best practices
</a><a href=/tags/debugging class=tag-cloud-item style=font-size:1rem>debugging
</a><a href=/tags/developer-tips class=tag-cloud-item style=font-size:1rem>developer tips
</a><a href=/tags/development class=tag-cloud-item style=font-size:1rem>development
</a><a href=/tags/productivity class=tag-cloud-item style=font-size:1rem>productivity
</a><a href=/tags/security class=tag-cloud-item style=font-size:1rem>security
</a><a href=/tags/serverless class=tag-cloud-item style=font-size:1rem>serverless
</a><a href=/tags/software-engineering class=tag-cloud-item style=font-size:1rem>software engineering
</a><a href=/tags/typescript class=tag-cloud-item style=font-size:1rem>typescript</a></div></div><div class=sidebar-widget><h3>Subscribe</h3><div class=subscribe-links><a href=/index.xml class=rss-link><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg>
RSS Feed</a></div></div><div class=sidebar-widget><h3>Archives</h3><ul class=archive-list></ul></div><div class="sidebar-widget npm-packages"><h3>My NPM Packages</h3><div id=npm-list></div></div></aside></div></div><footer class=site-footer><div class=container><p>&copy; 2025 Scott Obert. Powered by Hugo.</p></div></footer></body></html>